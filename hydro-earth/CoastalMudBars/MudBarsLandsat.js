/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var l5 = ee.ImageCollection("LANDSAT/LT5_L1T_TOA"),
    l7 = ee.ImageCollection("LANDSAT/LE7_L1T_TOA"),
    l8 = ee.ImageCollection("LANDSAT/LC8_L1T_TOA"),
    g = /* color: d63000 */ee.Geometry.Polygon(
        [[[-52.66502380371094, 5.204467582724752],
          [-52.6519775390625, 5.240708715048734],
          [-52.67120361328125, 5.2892548590694135],
          [-52.72064208984375, 5.3268584114938085],
          [-52.76802062988281, 5.311817265741307],
          [-52.78106689453125, 5.28788741401132],
          [-52.75428771972656, 5.239341163232307],
          [-52.70484924316406, 5.214040915546597]]]),
    i1_tw = /* color: 98ff00 */ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[-52.50683869833051, 5.082479786274452],
               [-52.50065749395259, 5.085814527956787],
               [-52.493533517019614, 5.090260459675435],
               [-52.494134406317926, 5.091286554244801],
               [-52.49593707529971, 5.09077368183219],
               [-52.49876971592727, 5.089320221924434],
               [-52.50735274432566, 5.08401947328617]]],
             [[[-53.09417724609375, 5.629652652785774],
               [-53.109283447265625, 5.640585888363403],
               [-53.117523193359375, 5.620085902939194]]],
             [[[-52.38143914472005, 5.1935265333851595],
               [-52.41062194121764, 5.16480480669605],
               [-52.40821865203242, 5.162069336411691],
               [-52.32994065457012, 5.2325034484536594],
               [-52.33509053433113, 5.2376318383862515]]],
             [[[-52.47422218322754, 5.068288371340346],
               [-52.48323440551758, 5.074785966266854],
               [-52.48400688171387, 5.073589045799894],
               [-52.47490882873535, 5.067176934081527]]],
             [[[-52.54692077636719, 5.08949080777202],
               [-52.545719146728516, 5.096672119898524],
               [-52.547006607055664, 5.0968431025425955],
               [-52.54829406738281, 5.088464899492958]]],
             [[[-52.41680145263672, 4.9963830095376744],
               [-52.413368225097656, 4.999290157749913],
               [-52.43396759033203, 5.0225468783063425],
               [-52.436885833740234, 5.019126824281111]]],
             [[[-52.43242263793945, 5.084275757047518],
               [-52.432379722595215, 5.085173432723521],
               [-52.432851791381836, 5.085173432723521],
               [-52.432894706726074, 5.0845749824118895]]]]),
        {
          "system:index": "0"
        }),
    i1_w = /* color: 0B4A8B */ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[-52.28084383438846, 5.351466838809766],
               [-52.274489837889746, 5.358649439480019],
               [-52.2774134837872, 5.363781426894087],
               [-52.30505350063834, 5.337284513937762],
               [-52.300932714189116, 5.332152989824122]]],
             [[[-52.719268798828125, 5.677484034899313],
               [-52.74261474609375, 5.670651222566598],
               [-52.723388671875, 5.648785679847313]]]]),
        {
          "system:index": "0"
        }),
    i1_m = /* color: ffc82d */ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[-52.520440748476744, 5.066492267070671],
               [-52.521041652123586, 5.068031331834141],
               [-52.52262988309337, 5.067518490050881],
               [-52.524261227703164, 5.066535273114387],
               [-52.52445412841371, 5.064504475896704],
               [-52.52207183085534, 5.065551692993175]]],
             [[[-52.49911308288574, 5.051402868623046],
               [-52.500057220458984, 5.052984567319059],
               [-52.50237465047428, 5.051744856306746],
               [-52.501258850097656, 5.0499066636015275]]]]),
        {
          "system:index": "0"
        }),
    i1_clouds = /* color: 00ffff */ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[-52.4302770555131, 5.070340644370325],
               [-52.42594289389331, 5.0720075320426465],
               [-52.42693021511832, 5.074785850119724],
               [-52.42838882758451, 5.074357700149147],
               [-52.429933223289936, 5.074101304969697],
               [-52.43087728260889, 5.073332660073507]]],
             [[[-52.4392032623291, 5.081112508979036],
               [-52.43971824645996, 5.081881949127958],
               [-52.44345188140869, 5.079958347033007],
               [-52.44302272796631, 5.079231651414076]]],
             [[[-52.44418144226074, 5.069186069268883],
               [-52.44456768035889, 5.069228816758163],
               [-52.44456768035889, 5.068844089252725]]],
             [[[-52.460832595825195, 5.078932423568159],
               [-52.46053218841553, 5.079274398237869],
               [-52.46096134185791, 5.079530879121091]]],
             [[[-52.42733716964722, 5.058969338244062],
               [-52.42748737335205, 5.058841093732805],
               [-52.42718696594238, 5.058798345556741]]],
             [[[-52.42748737335205, 5.059749491806718],
               [-52.42766976356506, 5.059792239919959],
               [-52.42774486541748, 5.059621247450048]]],
             [[[-52.428603172302246, 5.060903689872945],
               [-52.42874264717102, 5.060754071721235],
               [-52.42851734161377, 5.060743384709095]]],
             [[[-52.44722843170166, 5.028660180170585],
               [-52.446863651275635, 5.029622058107054],
               [-52.44718551635742, 5.029835808566592],
               [-52.44755029678345, 5.02887393094594]]]]),
        {
          "system:index": "0"
        }),
    i1_cloud_shadow_tw = /* color: bf04c2 */ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[-52.45654106140137, 5.082907867897073],
               [-52.45722770690918, 5.084874207637232],
               [-52.458858489990234, 5.084874207637232],
               [-52.45988845825195, 5.0838482920000985],
               [-52.458086013793945, 5.082736881549004]]],
             [[[-52.435855865478516, 5.076495848796292],
               [-52.43722915649414, 5.078120233000564],
               [-52.43800163269043, 5.077350788361233],
               [-52.43731498718262, 5.076068378588842]]],
             [[[-52.41731643676758, 5.094278358103851],
               [-52.41903305053711, 5.095133274054204],
               [-52.41946220397949, 5.09419286644626],
               [-52.417659759521484, 5.093337949245008]]],
             [[[-52.49344825733118, 5.13608241287554],
               [-52.495250702272585, 5.135313037588538],
               [-52.49396324160023, 5.132577473494416]]],
             [[[-52.3692512512207, 4.9389214434214646],
               [-52.37199783325195, 4.939434515239336],
               [-52.37062454223633, 4.93738222558583]]],
             [[[-52.3553466796875, 4.943539075484393],
               [-52.357749938964844, 4.94439418900158],
               [-52.356719970703125, 4.941828845138605]]],
             [[[-52.30934143066406, 4.9890295771021025],
               [-52.31088638305664, 4.990055642390556],
               [-52.3114013671875, 4.9883455326853055]]],
             [[[-52.47096061706543, 5.071195198206718],
               [-52.46967315673828, 5.073033331971309],
               [-52.46997356414795, 5.073247068115858],
               [-52.47143268585205, 5.07149442964133]]]]),
        {
          "system:index": "0"
        }),
    i1_land = /* color: ff0000 */ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[-52.47430804778503, 5.01040559448304],
               [-52.4743079824928, 5.011431626097258],
               [-52.47585298273748, 5.013569168244067],
               [-52.476625424687086, 5.012030138040035],
               [-52.47576716668527, 5.009550581280131]]],
             [[[-52.56378650665283, 5.008225282477247],
               [-52.56726264953613, 5.007669512727997],
               [-52.56691932678223, 5.006771729827531],
               [-52.56490230560303, 5.006771729827531]]]]),
        {
          "system:index": "0"
        }),
    i1_mud_foot = /* color: 00ff00 */ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[-52.45061876068917, 5.009465120687372],
               [-52.450532965031414, 5.010491100580152],
               [-52.45104792018276, 5.011175079731982],
               [-52.45182034743857, 5.010833102209312],
               [-52.45297906281513, 5.009892617776774],
               [-52.45207784358854, 5.0082681116736705]]],
             [[[-52.45872974395752, 5.011859149961554],
               [-52.45890140533447, 5.016006009338021],
               [-52.459845542907715, 5.016006009338021],
               [-52.45954513549805, 5.01211565749103]]],
             [[[-52.48950004577637, 5.04161335033214],
               [-52.49044418334961, 5.04221184040428],
               [-52.49018669128418, 5.041271355757577]]]]),
        {
          "system:index": "0"
        });
/***** End of imports. If edited, may not auto-convert in the playground. *****/
var bounds = ee.Geometry(Map.getBounds(true))
var vis_pars = {min: 0.03, max: [0.4, 0.4, 0.45], gamma: 1.5};

function addAsLayer(image) { 
  var id = image.get('LANDSAT_SCENE_ID').getInfo();
  print(image)
  print(image.get('DATE_ACQUIRED'))
  
  Map.addLayer(image, vis_pars, id)
}

var index = 20
var image = ee.Image(l5.filterBounds(bounds).toList(1, index).get(0))
  .select(['B3', 'B2', 'B1'], ['red', 'green', 'blue'])
//addAsLayer(image)

var index = 0
var image = ee.Image(l5.filterBounds(bounds).toList(1, index).get(0))
  .select(['B3', 'B2', 'B1'], ['red', 'green', 'blue'])
//addAsLayer(image)

var index = 10
var image = ee.Image(l8.filterBounds(bounds).toList(1, index).get(0))
  .select(['B4', 'B3', 'B2'], ['red', 'green', 'blue'])
addAsLayer(image)




// var chart = Chart.image.histogram(image, g, 30);
// print(chart)
  

// compute bounds for video
var scale = 30;
var bounds = Map.getBounds();
var region = '[['+bounds[0]+', '+bounds[1]+'], ['+bounds[2]+', '+bounds[1]+'], ['+bounds[2]+', '+bounds[3]+'], ['+bounds[0]+', ' + bounds[3] + ']]';

var fileName = image.get('LANDSAT_SCENE_ID').getInfo();

var url = image.visualize(vis_pars).getDownloadURL({
  format: 'png',
  scale: scale,
  region: region,
  crs: 'EPSG:4326'
});

print(url);

// classify image

function classifyImage(i) {
  var f_w = ee.FeatureCollection([i1_w.set('class', 0)])
  var f_tw = ee.FeatureCollection([i1_tw.set('class', 1)])
  var f_m = ee.FeatureCollection([i1_m.set('class', 2)])
  var f_clouds = ee.FeatureCollection([i1_clouds.set('class', 3)])
  var f_cloud_shadow_tw = ee.FeatureCollection([i1_cloud_shadow_tw.set('class', 4)])
  var f_land = ee.FeatureCollection([i1_land.set('class', 5)])
  var f_mud_foot = ee.FeatureCollection([i1_mud_foot.set('class', 6)])

  var trainingSet = f_w.merge(f_tw).merge(f_m)
    .merge(f_clouds).merge(f_cloud_shadow_tw).merge(f_land).merge(f_mud_foot)

 var trained = i.trainClassifier({
    'training_features': trainingSet,
    'training_property':'class',
    'classifier_name': 'Cart',
    'crs':'EPSG:4326',
    "crs_transform": [8.9831528411952135e-05, 0, -180, 0, -8.9831528411952135e-05, 90]
    
    //i.select(0).projection().getInfo()['transform']
  });


  // Apply the classifier to the same image we used to train it
  var classified = i.classify(trained);
   
  Map.addLayer(classified, {
    palette: 'FF0000,00FF00,0000FF,FFFFFF,CCCCCC,11aa11,000000',
    max: 6
  }, i.get('LANDSAT_SCENE_ID').getInfo() + ' classified');
  
  return classified;
}

var id = 'LANDSAT/LC8_L1T_TOA/LC82270562013284LGN00'
var image = ee.Image(id).select(['B4', 'B3', 'B2'], ['red', 'green', 'blue'])
Map.addLayer(image, vis_pars, id)
var c = classifyImage(ee.Image(id))

var url = c.getDownloadURL({
  name: 'classified',
  scale: scale,
  region: region,
  crs: 'EPSG:4326'
});

print(url);



