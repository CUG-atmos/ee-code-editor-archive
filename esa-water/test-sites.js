/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var S1 = ee.ImageCollection("COPERNICUS/S1_GRD"),
    S2_1C = ee.ImageCollection("COPERNICUS/S2"),
    S2_2A = ee.ImageCollection("COPERNICUS/S2_SR"),
    S3 = ee.ImageCollection("COPERNICUS/S3/OLCI"),
    L7_TOA = ee.ImageCollection("LANDSAT/LE07/C01/T1_TOA"),
    L7_SR = ee.ImageCollection("LANDSAT/LE07/C01/T1_SR"),
    L8_TOA = ee.ImageCollection("LANDSAT/LC08/C01/T1_TOA"),
    L8_SR = ee.ImageCollection("LANDSAT/LC08/C01/T1_SR"),
    JRC_water = ee.Image("JRC/GSW1_1/GlobalSurfaceWater"),
    countries = ee.FeatureCollection("USDOS/LSIB_SIMPLE/2017"),
    SARAL_AltiKa_tracks = ee.FeatureCollection("users/arjenhaag/WW-SWD/SARAL_AltiKa_tracks"),
    Jason2_tracks_before_Oct2016 = ee.FeatureCollection("users/arjenhaag/WW-SWD/Jason2_tracks_before_Oct2016"),
    Jason2_tracks_after_Oct2016 = ee.FeatureCollection("users/arjenhaag/WW-SWD/Jason2_tracks_after_Oct2016"),
    Jason3_tracks = ee.FeatureCollection("users/arjenhaag/WW-SWD/Jason3_tracks"),
    S3A_tracks = ee.FeatureCollection("users/arjenhaag/WW-SWD/S3A_tracks"),
    S3B_tracks = ee.FeatureCollection("users/arjenhaag/WW-SWD/S3B_tracks"),
    catchments = ee.FeatureCollection("users/arjenhaag/WW-SWD/catchments"),
    hydroweb_locs = ee.FeatureCollection("users/arjenhaag/WW-SWD/hydroweb_locs"),
    Colombia_1 = /* color: #d63000 */ee.Geometry.Polygon(
        [[[-74.55847952073958, 10.464326772391296],
          [-74.49150317058769, 10.52396211751524],
          [-74.34386890345627, 10.526948846499053],
          [-74.24012882856732, 10.648689966416319],
          [-74.18222588681027, 10.843519107118334],
          [-74.15949100729262, 10.902903781574317],
          [-74.18207470059008, 10.964311205445705],
          [-74.20390154113414, 10.990719811282831],
          [-74.21210228483983, 10.995568848204595],
          [-74.22330712987912, 10.996120710738024],
          [-74.23267052210167, 10.996044896957141],
          [-74.24092588776045, 10.992017558042583],
          [-74.24790962510747, 10.992304049536278],
          [-74.25469374399285, 10.999231872397132],
          [-74.26027628748722, 11.005063691707715],
          [-74.27049699897844, 11.000887231723699],
          [-74.2823548149745, 10.995061033994777],
          [-74.28838875052156, 10.989811462663758],
          [-74.29187336545544, 10.988748675523176],
          [-74.30347662681186, 10.984262792490833],
          [-74.31621088370338, 10.980682014383987],
          [-74.33155036974267, 10.97823677054997],
          [-74.33871103296786, 10.976041489376707],
          [-74.37345671151252, 10.968779421178898],
          [-74.3856132593595, 10.971947173133094],
          [-74.39705083484444, 10.970864728094421],
          [-74.43142605812113, 10.972902695347766],
          [-74.44372040795531, 10.970517172506531],
          [-74.4676023735991, 10.97470298299444],
          [-74.48715033816234, 10.978339940225005],
          [-74.50549709638204, 10.981301646323566],
          [-74.51579817513942, 10.982701239439418],
          [-74.52709935678416, 10.985946145856463],
          [-74.5403749560993, 10.991086540027279],
          [-74.54452442054037, 10.991340596409238],
          [-74.55093504753518, 10.98881515448692],
          [-74.5574908712295, 10.990925748835608],
          [-74.56716953432328, 10.992113050934256],
          [-74.57296592393436, 10.994487217856822],
          [-74.57906579007488, 10.995696281296711],
          [-74.58484004750972, 10.997122935920704],
          [-74.59155937057142, 10.998969864060804],
          [-74.59899019207319, 11.000809658205826],
          [-74.60717010682214, 11.00917956678978],
          [-74.61337680918552, 11.011566320685402],
          [-74.63117085210712, 11.013278841453753],
          [-74.6397913251813, 11.012070434238872],
          [-74.64467814072987, 11.010777701440144],
          [-74.65084399306375, 11.005490566004381],
          [-74.66104369918708, 11.002478011542273],
          [-74.68184549347797, 11.003809703387665],
          [-74.70152244298146, 10.990213293260034],
          [-74.72325765760866, 10.979985735669034],
          [-74.73465967963011, 10.967379095360629],
          [-74.74235602216191, 10.957268606782744],
          [-74.73340177072492, 10.948172052610756],
          [-74.72579391125407, 10.940091543845911],
          [-74.72385126665478, 10.932264378968338],
          [-74.72671511940268, 10.925111397597162],
          [-74.71605050295733, 10.918306458434687],
          [-74.70830464535464, 10.908551434377975],
          [-74.69560617181361, 10.878889841143812],
          [-74.70977565009758, 10.84704865983984],
          [-74.7225756902742, 10.798239751200134],
          [-74.71659846220223, 10.780211367622206],
          [-74.71495086492246, 10.76316155068833],
          [-74.70060104098371, 10.7538689747295],
          [-74.6997109089778, 10.740680630549976],
          [-74.70411025715543, 10.735891448403336],
          [-74.70878907016163, 10.710460708352471],
          [-74.70144945387312, 10.58168669316636],
          [-74.6639425634304, 10.494720995778996],
          [-74.65127275705152, 10.478179746643804],
          [-74.62006499751783, 10.473790393296374],
          [-74.6160149249888, 10.468387518513973]]]),
    Colombia_2 = /* color: #ff00ff */ee.Geometry.Polygon(
        [[[-74.90916959137024, 9.897963946228828],
          [-74.92015591949524, 9.665191889100628],
          [-74.94762173980774, 9.491861368603425],
          [-74.87621060699524, 9.388904771241274],
          [-74.85423795074524, 9.215435185638317],
          [-74.94212857574524, 9.112397183964802],
          [-74.95860806793274, 9.025605268121636],
          [-75.09044400543274, 9.003904017745986],
          [-75.22227994293274, 8.857386661504528],
          [-75.22777310699524, 8.72709994649835],
          [-75.31017056793274, 8.537017118055207],
          [-75.26622525543274, 8.341404564939022],
          [-75.13438931793274, 8.221815189235866],
          [-74.99156705230774, 8.232688449128634],
          [-74.87621060699524, 8.107628032292022],
          [-74.70042935699524, 8.123942479031692],
          [-74.48619595855774, 8.238124967145238],
          [-74.43126431793274, 8.330534307723731],
          [-74.48619595855774, 8.466390693485199],
          [-74.43675748199524, 8.634785959245916],
          [-74.37083951324524, 8.61306172913897],
          [-74.21703091949524, 8.6673699582696],
          [-74.09068814605774, 8.841103332563767],
          [-73.98082486480774, 8.895378289133019],
          [-73.88744107574524, 8.77596283128761],
          [-73.86546841949524, 8.580473045470075],
          [-73.87096158355774, 8.346839580180179],
          [-73.93687955230774, 8.085874407404896],
          [-74.04124966949524, 7.944447380138245],
          [-73.92040006012024, 7.90636251108694],
          [-73.83800259918274, 7.982528716716811],
          [-73.72813931793274, 7.900921528105121],
          [-73.64024869293274, 7.9770887426760435],
          [-73.67320767730774, 8.134818408554558],
          [-73.66771451324524, 8.395751307743884],
          [-73.67870084137024, 8.564177654096813],
          [-73.70616666168274, 8.797677606347929],
          [-73.67870084137024, 9.052729994830571],
          [-73.55785123199524, 9.193745461469465],
          [-73.68419400543274, 9.30760161613915],
          [-73.84349576324524, 9.323863765270527],
          [-73.98082486480774, 9.215435185638317],
          [-74.16209927887024, 9.264232190110201],
          [-74.32140103668274, 9.410582398137977],
          [-74.56859341949524, 9.43225866579042],
          [-74.60704556793274, 9.556870675762346],
          [-74.62901822418274, 9.800544331766142],
          [-74.71690884918274, 9.97371479501185],
          [-74.65099088043274, 10.19545480309912],
          [-74.81029263824524, 10.222485780743192],
          [-74.96959439605774, 10.081899717463557]]]),
    Colombia_3 = /* color: #98ff00 */ee.Geometry.Polygon(
        [[[-71.53342010604712, 4.716298631508729],
          [-71.48947479354712, 4.650600765596059],
          [-71.27798797714087, 4.740933733680594],
          [-71.08847381698462, 4.858622574367171],
          [-71.02255584823462, 4.910618104849225],
          [-70.95389129745337, 5.020069077976704],
          [-70.86874725448462, 5.107616654123334],
          [-70.74515106307837, 5.19788756844499],
          [-70.64078094589087, 5.290880432461809],
          [-70.63803436385962, 5.342840961607293],
          [-70.54190399276587, 5.413937694361157],
          [-70.41556121932837, 5.474089942792971],
          [-70.34140350448462, 5.531502354050872],
          [-70.22604705917212, 5.547904879408821],
          [-70.11069061385962, 5.594376219999677],
          [-70.03927948104712, 5.6627097117639185],
          [-69.99258758651587, 5.741966433140035],
          [-69.93490936385962, 5.8239445437948065],
          [-69.86624481307837, 5.903178681972243],
          [-69.81680633651587, 6.006985555113743],
          [-69.87448455917212, 6.03429987839242],
          [-69.94589569198462, 5.968743201828587],
          [-69.98984100448462, 5.903178681972243],
          [-70.02005340682837, 5.826676942392543],
          [-70.07773162948462, 5.755630275229181],
          [-70.14090301620337, 5.6736423231211015],
          [-70.23428680526587, 5.616243810606419],
          [-70.36612274276587, 5.608043560134334],
          [-70.45401336776587, 5.56704058244878],
          [-70.56662323104712, 5.506897713752623],
          [-70.64902069198462, 5.457685381498219],
          [-70.74240448104712, 5.375655870179116],
          [-70.75064422714087, 5.312759084365874],
          [-70.80832244979712, 5.255325974353033],
          [-70.89621307479712, 5.19788756844499],
          [-70.99234344589087, 5.134972829459873],
          [-71.03628875839087, 5.047428967514149],
          [-71.07474090682837, 4.965345862023267],
          [-71.14889862167212, 4.921564017203138],
          [-71.23404266464087, 4.880515920663283],
          [-71.34390594589087, 4.8285180627157525],
          [-71.43454315292212, 4.771042109624185]]]),
    Spain_1 = /* color: #0b4a8b */ee.Geometry.Polygon(
        [[[-4.120867966383344, 43.004090343467446],
          [-4.124301193922406, 42.98450347731392],
          [-4.1019852149185, 42.96968362398785],
          [-4.050143479078656, 42.963654187140136],
          [-4.004138230055219, 42.96717143045638],
          [-3.9914352881606874, 42.974456509025245],
          [-3.9780457007583436, 42.98676381893197],
          [-3.964656113356, 42.985256933754584],
          [-3.9560730445083436, 42.97621484698504],
          [-3.9447433936294374, 42.97119089085723],
          [-3.935817002027875, 42.97244691836572],
          [-3.9323837744888124, 42.97772195379181],
          [-3.941310166090375, 42.982745376373295],
          [-3.94543003913725, 42.989777478470444],
          [-3.9409668433364686, 42.99228874855007],
          [-3.932040451734906, 42.98902407743788],
          [-3.9200241553481874, 42.98877294170822],
          [-3.9076645362075624, 42.9880195283627],
          [-3.8932449805435, 42.984001167889794],
          [-3.882601975172406, 42.986512673967574],
          [-3.878482102125531, 42.9942976907354],
          [-3.872988938063031, 43.00057521179917],
          [-3.8654358374770936, 43.0023328027731],
          [-3.86303257819975, 43.00886055761438],
          [-3.8626892554458436, 43.01789784223037],
          [-3.8709290015395936, 43.025427896853216],
          [-3.8929016577895936, 43.03672124711717],
          [-3.909724472731, 43.03948152778099],
          [-3.9341003882583436, 43.042241684273826],
          [-3.94543003913725, 43.0515249357403],
          [-3.9694626319106874, 43.05202669309394],
          [-3.9811356055435, 43.04424899282189],
          [-3.978732346266156, 43.034964640225915],
          [-3.964656113356, 43.02919257783267],
          [-3.963626145094281, 43.02266698405891],
          [-3.968775986402875, 43.02040796305415],
          [-3.9725525366958436, 43.02467493295061],
          [-3.9835388648208436, 43.024925921944316],
          [-3.998988388746625, 43.020156955589464],
          [-4.023364304273969, 43.01614069659758],
          [-4.064219711988812, 43.01187313358398],
          [-4.0909988867935, 43.00911161125558]]]),
    Spain_2 = /* color: #ffc82d */ee.Geometry.Polygon(
        [[[-0.716142246633126, 42.12735174998389],
          [-0.7099624370628135, 42.12136772629183],
          [-0.7077308391624229, 42.115892486129404],
          [-0.7075591777854697, 42.11143554606178],
          [-0.7070441936546104, 42.10837917744654],
          [-0.706669502214595, 42.107182249934276],
          [-0.7078711318532669, 42.106227086486165],
          [-0.708343200639888, 42.105462945366035],
          [-0.7083002852956497, 42.10406199605792],
          [-0.706969909624263, 42.10336150979509],
          [-0.6971852111379349, 42.100750538270525],
          [-0.6874005126516067, 42.10100527193275],
          [-0.6820790099660599, 42.100304751899166],
          [-0.6728092956105911, 42.10221524285324],
          [-0.6703202056447708, 42.104698795035596],
          [-0.6683460998098099, 42.10832842707563],
          [-0.6627671050588333, 42.1090288584602],
          [-0.6607302001420976, 42.10961082957859],
          [-0.6598933509294511, 42.10972226010772],
          [-0.6569965651933671, 42.10900591757396],
          [-0.6560738852922441, 42.109181024274214],
          [-0.6537349990312578, 42.10935613049076],
          [-0.6533702186052324, 42.10983369044097],
          [-0.6532843879167558, 42.11099573795755],
          [-0.6525119117204667, 42.11368587580343],
          [-0.6504096454916635, 42.11481609951227],
          [-0.648349708968226, 42.11901814159498],
          [-0.6464756858921419, 42.119706692234274],
          [-0.6437291038608919, 42.11972260835769],
          [-0.6371201408481966, 42.12058207308626],
          [-0.6355751884556184, 42.123001244548156],
          [-0.6388367546177278, 42.12758468454444],
          [-0.6384934318638216, 42.13242240035394],
          [-0.6414116752720247, 42.14655150694021],
          [-0.6393517387485872, 42.151896833247406],
          [-0.6393517387485872, 42.1608047073575],
          [-0.6345452201938997, 42.170220239453506],
          [-0.6455315483188997, 42.170474693845726],
          [-0.674713982400931, 42.170220239453506],
          [-0.7001198661899934, 42.16894795213836],
          [-0.715912712869681, 42.1564781822502],
          [-0.717286003885306, 42.14400595481512],
          [-0.7114495170688997, 42.137387040290804]]]),
    Zambia_1 = /* color: #00ffff */ee.Geometry.Polygon(
        [[[22.745505439095382, -15.09676180274781],
          [22.827902900032882, -15.377664520769658],
          [22.932273017220382, -15.483567583207078],
          [23.009177314095382, -15.748087397896885],
          [23.080588446907882, -15.943610929071472],
          [23.151999579720382, -16.233901466799605],
          [23.245383368782882, -16.291908478971568],
          [23.388205634407882, -16.260270414180756],
          [23.366232978157882, -16.123113356192047],
          [23.371726142220382, -15.922482393479125],
          [23.322287665657882, -15.726938400613056],
          [23.283835517220382, -15.610579688557529],
          [23.311301337532882, -15.499448376225507],
          [23.267356025032882, -15.388257256365875],
          [23.179465400032882, -15.277006715776157],
          [23.201438056282882, -15.038414415262057],
          [23.377219306282882, -14.95351699806841],
          [23.421164618782882, -14.852657674524762],
          [23.542014228157882, -14.650798000235493],
          [23.377219306282882, -14.650798000235493],
          [23.190451728157882, -14.650798000235493],
          [23.217917548470382, -14.544481172007547],
          [23.223410712532882, -14.41151316561209],
          [23.097067939095382, -14.374267876583794],
          [22.954245673470382, -14.432793395942946],
          [22.816916571907882, -14.53384666710944],
          [22.761984931282882, -14.751751244873514]]]),
    Zambia_2 = /* color: #ff0000 */ee.Geometry.Polygon(
        [[[29.82344339254462, -10.813286222720613],
          [29.707400301724306, -10.865888958075127],
          [29.660021761685243, -10.957584353718119],
          [29.65315530660712, -10.999377254207559],
          [29.632713954921996, -11.002730648053127],
          [29.610741298671996, -11.032386195086849],
          [29.62584749984387, -11.10078472447497],
          [29.638075603281095, -11.113786847901366],
          [29.60648990992172, -11.161620473864023],
          [29.589323772226408, -11.167009684947079],
          [29.565977824960783, -11.180482274769965],
          [29.534392131601408, -11.239754222023704],
          [29.53233219507797, -11.257937493581016],
          [29.534270813325634, -11.2975246801038],
          [29.523284485200634, -11.45908065734105],
          [29.484832336763134, -11.57749645570377],
          [29.523284485200634, -11.698551681444277],
          [29.548003723481884, -11.814177222050763],
          [29.633147766450634, -11.889442072870583],
          [29.751250793794384, -11.870627806280572],
          [29.877593567231884, -11.798046344194209],
          [29.957244446138134, -11.730824155861376],
          [29.951751282075634, -11.6017117109801],
          [29.999462154286675, -11.372225338203238],
          [30.065380123036675, -11.143258044414386],
          [30.073619869130425, -11.035446100721838],
          [30.0722465781148, -10.9626506422276],
          [30.024181392567925, -10.87769996673454],
          [29.9349174765523, -10.826448159333628]]]),
    Zambia_3 = /* color: #bf04c2 */ee.Geometry.Polygon(
        [[[27.20756151952105, -17.409504589795223],
          [27.25150683202105, -17.514304988277853],
          [27.09220507420855, -17.655689566639058],
          [26.99882128514605, -17.81788312753817],
          [26.93839648045855, -17.943351138352956],
          [26.98234179295855, -18.026947117896217],
          [27.10868456639605, -18.026947117896217],
          [27.21854784764605, -17.938125075942875],
          [27.29545214452105, -17.823112729407562],
          [27.34489062108355, -17.708026108175257],
          [27.48221972264605, -17.608573664427265],
          [27.59757616795855, -17.56144546207919],
          [27.71842577733355, -17.346595462319524],
          [27.86674120702105, -17.22595936654404],
          [28.06449511327105, -17.18398048887862],
          [28.16337206639605, -17.068489582654678],
          [28.16886523045855, -16.96343577476766],
          [28.30619433202105, -16.905631101426497],
          [28.37760546483355, -16.95292715533442],
          [28.39957812108355, -17.00021131109866],
          [28.48746874608355, -17.005464370461368],
          [28.53141405858355, -16.92139777294087],
          [28.52042773045855, -16.832035881516585],
          [28.59733202733355, -16.80048630852355],
          [28.66324999608355, -16.842551238539585],
          [28.75114062108355, -16.863580199692972],
          [28.88846972264605, -16.832035881516585],
          [28.99833300389605, -16.76893148940618],
          [29.08622362889605, -16.632133530415373],
          [29.06974413670855, -16.537370012524562],
          [28.91044237889605, -16.479436037763197],
          [28.77860644139605, -16.495237934075973],
          [28.69071581639605, -16.416215570207648],
          [28.58085253514605, -16.442559934210433],
          [28.42155077733355, -16.495237934075973],
          [28.25675585545855, -16.495237934075973],
          [28.16886523045855, -16.558432604123254],
          [28.09196093358355, -16.63739680035163],
          [28.03702929295855, -16.711067391218656],
          [27.97111132420855, -16.758412052065164],
          [27.88871386327105, -16.726850251650273],
          [27.74589159764605, -16.76893148940618],
          [27.74039843358355, -16.83729363303177],
          [27.65250780858355, -16.931908154100256],
          [27.53715136327105, -17.057986856468247],
          [27.43278124608355, -17.204971118173507],
          [27.33390429295855, -17.262683064436427]]]),
    Mexico_1 = /* color: #0000ff */ee.Geometry.Polygon(
        [[[-92.65985308726351, 18.416109044092483],
          [-92.75323687632601, 18.30662557402176],
          [-92.82464800913851, 18.097894328165292],
          [-92.81640826304476, 17.993435247230185],
          [-92.72302447398226, 17.901982770106514],
          [-92.62414752085726, 17.779100982564536],
          [-92.48132525523226, 17.70323808516491],
          [-92.35498248179476, 17.70323808516491],
          [-92.14349566538851, 17.718936492705854],
          [-92.05560504038851, 17.713703842821168],
          [-91.95123492320101, 17.742481527191355],
          [-91.75348101695101, 17.711087460635614],
          [-91.71228228648226, 17.729401334392428],
          [-91.66284380991976, 17.705854581802594],
          [-91.58319293101351, 17.650900149341794],
          [-91.55298052866976, 17.567127816759434],
          [-91.49255572398226, 17.480696968331983],
          [-91.37994586070101, 17.491175626265804],
          [-91.33600054820101, 17.58807454321194],
          [-91.33600054820101, 17.734633526115946],
          [-91.40741168101351, 17.826172112134095],
          [-91.61340533335726, 17.841859727365993],
          [-91.72052203257601, 17.91505030298011],
          [-91.81390582163851, 17.988210665937753],
          [-91.98419390757601, 18.04828400155816],
          [-92.10779009898226, 18.103115651979213],
          [-92.21216021616976, 18.103115651979213],
          [-92.30554400523226, 18.22838067118432],
          [-92.45660601695101, 18.374409244743575]]]),
    Mexico_2 = /* color: #999900 */ee.Geometry.Polygon(
        [[[-99.45940730102211, 27.034269499780105],
          [-99.45940730102211, 27.009802072407343],
          [-99.41958186156899, 26.981657945396254],
          [-99.43331477172524, 26.95473088832277],
          [-99.40310236938149, 26.925348575876278],
          [-99.38112971313149, 26.899632773043997],
          [-99.36327692992836, 26.89718334344837],
          [-99.35778376586586, 26.8726861264719],
          [-99.34267756469399, 26.839606463378043],
          [-99.36602351195961, 26.802839944969758],
          [-99.39348933227211, 26.772192071308755],
          [-99.37151667602211, 26.735403702705447],
          [-99.31658503539711, 26.736630173480556],
          [-99.30285212524086, 26.774644205746554],
          [-99.31109187133461, 26.793033525934074],
          [-99.30010554320961, 26.799162637178185],
          [-99.28225276000649, 26.783226259254974],
          [-99.29186579711586, 26.74766781527364],
          [-99.26989314086586, 26.73049768736173],
          [-99.27401301391274, 26.70596443764327],
          [-99.24929377563149, 26.692468896981286],
          [-99.24929377563149, 26.655654754450456],
          [-99.23830744750649, 26.629877786780803],
          [-99.29461237914711, 26.65933670338691],
          [-99.31658503539711, 26.64583564329735],
          [-99.29735896117836, 26.628650167024617],
          [-99.26851984985024, 26.607778613726644],
          [-99.25753352172524, 26.573393634668292],
          [-99.22365706882579, 26.57036294851706],
          [-99.2082075449, 26.562993200206886],
          [-99.18623488865, 26.557158479990495],
          [-99.15155929050547, 26.547638035733076],
          [-99.131303248025, 26.553166131871524],
          [-99.12272017917735, 26.56944175590109],
          [-99.11757033786876, 26.594925351999937],
          [-99.1199735971461, 26.616106191749278],
          [-99.13988631687266, 26.624700196269874],
          [-99.14434951267344, 26.634521124505877],
          [-99.12409347019297, 26.64004502567893],
          [-99.1144804330836, 26.654467285881182],
          [-99.12958663425547, 26.672876034140526],
          [-99.09388106784922, 26.68882787967602],
          [-99.09388106784922, 26.70477749292361],
          [-99.12958663425547, 26.71213809972662],
          [-99.12492285531494, 26.729309105746097],
          [-99.10707007211181, 26.72869583254484],
          [-99.095397098479, 26.749545266595387],
          [-99.12904272836181, 26.775295171008157],
          [-99.15788183968994, 26.767325586177115],
          [-99.17298804086181, 26.737894583444984],
          [-99.17848120492431, 26.759968549993363],
          [-99.20045386117431, 26.759968549993363],
          [-99.20388708871337, 26.775908192829462],
          [-99.17573462289306, 26.7881679341603],
          [-99.18809424203369, 26.799200569113218],
          [-99.20365425148975, 26.806700058304088],
          [-99.19953437844288, 26.81987565012497],
          [-99.20708747902881, 26.834887829491556],
          [-99.22459693947803, 26.835500529249668],
          [-99.23283668557178, 26.82508418260197],
          [-99.24622627297413, 26.831517921573614],
          [-99.24004646340381, 26.8508169457814],
          [-99.24622627297413, 26.857249222747168],
          [-99.24125874161967, 26.86355185484595],
          [-99.22992909074077, 26.85987651752945],
          [-99.2151662123228, 26.86783959745263],
          [-99.19765675187358, 26.86783959745263],
          [-99.19147694230327, 26.877639541538276],
          [-99.21104633927592, 26.89203166924506],
          [-99.20520985245952, 26.91132036902112],
          [-99.18564045548686, 26.922034889496192],
          [-99.16401112199077, 26.93060577337279],
          [-99.1715642225767, 26.952948229319297],
          [-99.19491016984233, 26.954478372471144],
          [-99.2374821913267, 26.924789887472652],
          [-99.25773823380717, 26.906115806356016],
          [-99.27662098527202, 26.90182951577535],
          [-99.29550373673686, 26.885601370617024],
          [-99.30992329240092, 26.88927587178601],
          [-99.30202686906108, 26.908258890629188],
          [-99.30614674210796, 26.923565452233024],
          [-99.31850636124858, 26.941012399652074],
          [-99.34803211808452, 26.947745587178655],
          [-99.36142170548686, 26.969166689318474],
          [-99.37370242800165, 26.990456968945168],
          [-99.40013828005243, 27.013093419560775],
          [-99.43515720095087, 27.03694852733074]]]),
    Mexico_3 = /* color: #d63000 */ee.Geometry.Polygon(
        [[[-93.87788161606841, 17.09973582872645],
          [-93.86689528794341, 17.081358748952926],
          [-93.84766921372466, 17.078076936903084],
          [-93.8222633299356, 17.038034182670142],
          [-93.81814345688872, 17.02227730402456],
          [-93.80372390122466, 17.012428581050134],
          [-93.78793105454497, 17.01505495783714],
          [-93.78037795395903, 17.024903542631744],
          [-93.78655776352934, 17.038034182670142],
          [-93.79823073716216, 17.043942669882917],
          [-93.7893043455606, 17.062323435333862],
          [-93.79067763657622, 17.07938966865377],
          [-93.78449782700591, 17.095798035636378],
          [-93.76801833481841, 17.11286120431323],
          [-93.74947890610747, 17.11614240359706],
          [-93.73917922349028, 17.12270462856111],
          [-93.71720656724028, 17.124017045772046],
          [-93.69317397446684, 17.1338598795822],
          [-93.68356093735747, 17.120735985379678],
          [-93.6849342283731, 17.108923688805024],
          [-93.66364821763091, 17.099079535659225],
          [-93.6464820799356, 17.09973582872645],
          [-93.63755568833403, 17.08923486218776],
          [-93.61695632309966, 17.075451445681608],
          [-93.60185012192778, 17.085953188781488],
          [-93.60391005845122, 17.108923688805024],
          [-93.59223708481841, 17.11089245697195],
          [-93.59017714829497, 17.093829107876026],
          [-93.57850417466216, 17.07610782195181],
          [-93.56614455552153, 17.076764195912165],
          [-93.56339797349028, 17.09448541944152],
          [-93.55447158188872, 17.102360977868127],
          [-93.54073867173247, 17.090547515371092],
          [-93.52769240708403, 17.093829107876026],
          [-93.5201393064981, 17.083327808458026],
          [-93.50228652329497, 17.06954395532047],
          [-93.48031386704497, 17.052476821638916],
          [-93.45559462876372, 17.038690690471586],
          [-93.43018874497466, 17.03343856351595],
          [-93.40958937974028, 17.0229338671317],
          [-93.40409621567778, 17.00783233303905],
          [-93.3937965330606, 17.00257934006836],
          [-93.37113723130278, 17.009145558266212],
          [-93.34504470200591, 17.012428581050134],
          [-93.31620559067778, 17.0032359722443],
          [-93.31345900864653, 16.997326199828397],
          [-93.29835280747466, 16.990759567492006],
          [-93.2949195799356, 16.997326199828397],
          [-93.28324660630278, 16.99404291241103],
          [-93.27020034165434, 16.997982850410818],
          [-93.25921401352934, 17.00848894680352],
          [-93.23518142075591, 17.01374177404846],
          [-93.20496901841216, 17.0209641709001],
          [-93.19741591782622, 17.03540812841213],
          [-93.21389541001372, 17.04000369915825],
          [-93.24822768540434, 17.03409508745287],
          [-93.2729469236856, 17.020307600882926],
          [-93.28461989731841, 17.01833787701255],
          [-93.3059059080606, 17.0209641709001],
          [-93.3223854002481, 17.026873197398135],
          [-93.35122451157622, 17.038690690471586],
          [-93.36358413071684, 17.038034182670142],
          [-93.38349685044341, 17.03146897787697],
          [-93.38624343247466, 17.040660200043327],
          [-93.39585646958403, 17.053789733461905],
          [-93.4157691893106, 17.063636277926356],
          [-93.40340957016997, 17.072169529685958],
          [-93.41645583481841, 17.081358748952926],
          [-93.41164931626372, 17.08923486218776],
          [-93.39791640610747, 17.090547515371092],
          [-93.39104995102934, 17.101048407922857],
          [-93.40203627915434, 17.106954899814564],
          [-93.42057570786528, 17.107611165124982],
          [-93.41782912583403, 17.11745486710904],
          [-93.42400893540434, 17.132547531852058],
          [-93.42812880845122, 17.15748055350622],
          [-93.42812880845122, 17.16535344364678],
          [-93.44598159165434, 17.167321613977617],
          [-93.45765456528716, 17.154200084028226],
          [-93.45284804673247, 17.137796867169598],
          [-93.46177443833403, 17.135172218045593],
          [-93.4707008299356, 17.143702192137457],
          [-93.48306044907622, 17.156168372672948],
          [-93.49198684067778, 17.168633715928333],
          [-93.50434645981841, 17.166665559521228],
          [-93.4981666502481, 17.184378215065045],
          [-93.50228652329497, 17.19421784770957],
          [-93.51739272446684, 17.192249963001515],
          [-93.53524550766997, 17.185690196284895],
          [-93.55241164536528, 17.185690196284895],
          [-93.5695777830606, 17.18831413084993],
          [-93.58125075669341, 17.184378215065045],
          [-93.58468398423247, 17.192905926894586],
          [-93.56614455552153, 17.204056957488476],
          [-93.56751784653716, 17.214551431309605],
          [-93.53318557114653, 17.220454311150522],
          [-93.50503310532622, 17.240785009759033],
          [-93.5146461424356, 17.28406226373542],
          [-93.50503310532622, 17.31684129339876],
          [-93.47756728501372, 17.331262215042855],
          [-93.43911513657622, 17.315530244389002],
          [-93.39242324204497, 17.30897485906037],
          [-93.3718238768106, 17.337816805066],
          [-93.35809096665434, 17.36665421921088],
          [-93.38006362290434, 17.3876240338214],
          [-93.3553443846231, 17.395487094903203],
          [-93.31963881821684, 17.369275577366736],
          [-93.2839332518106, 17.354857643421056],
          [-93.25921401352934, 17.37058624237767],
          [-93.2784400877481, 17.398108040145786],
          [-93.3059059080606, 17.42562569612457],
          [-93.34573134751372, 17.436107522042768],
          [-93.3828102049356, 17.43479732673058],
          [-93.4267555174356, 17.460999444421642],
          [-93.44598159165434, 17.46623941588775],
          [-93.4707008299356, 17.4505190492988],
          [-93.49130019516997, 17.428246209045223],
          [-93.48580703110747, 17.40072894782111],
          [-93.4652076658731, 17.39941849867965],
          [-93.45284804673247, 17.37451818113501],
          [-93.43499526352934, 17.36534352606719],
          [-93.45010146470122, 17.357479170323366],
          [-93.47482070298247, 17.37058624237767],
          [-93.50091323227934, 17.390245091736066],
          [-93.5311256346231, 17.383692376549437],
          [-93.5640846189981, 17.367964902977608],
          [-93.57095107407622, 17.337816805066],
          [-93.5640846189981, 17.314219186026428],
          [-93.56271132798247, 17.28012838779146],
          [-93.55584487290434, 17.255211889598236],
          [-93.59292373032622, 17.235538592068625],
          [-93.61214980454497, 17.21192786867205],
          [-93.64236220688872, 17.201433246020223],
          [-93.65609511704497, 17.226357002508028],
          [-93.6904273924356, 17.2460312783702],
          [-93.72201308579497, 17.239473419311057],
          [-93.77694472641997, 17.236850210465224],
          [-93.8057838377481, 17.210616073397283],
          [-93.80715712876372, 17.183066224554477],
          [-93.84148940415434, 17.16338525243213],
          [-93.8717018064981, 17.13057899288304]]]),
    Mexico_4 = /* color: #009999 */ee.Geometry.Polygon(
        [[[-98.87297168062497, 24.082504036811812],
          [-98.88807788179685, 24.042377500391453],
          [-98.90867724703122, 23.944516560686914],
          [-98.89494433687497, 23.86793251486404],
          [-98.87846484468747, 23.769939363376462],
          [-98.80430712984372, 23.736001434474684],
          [-98.70680346773435, 23.74605803931467],
          [-98.6765910653906, 23.79381630427772],
          [-98.66972461031247, 23.860397208001224],
          [-98.67247119234372, 23.92317802748373],
          [-98.66148486421872, 23.952046965387453],
          [-98.66697802828122, 23.975890346068233],
          [-98.68620410249997, 24.006001994018433],
          [-98.6820842294531, 24.046139896161982],
          [-98.70268359468747, 24.088772674272803],
          [-98.73838916109372, 24.10381615307407],
          [-98.78782763765622, 24.10256259731627],
          [-98.8139201669531, 24.10381615307407],
          [-98.83383288667966, 24.112904065327264],
          [-98.86129870699216, 24.111650598540567],
          [-98.87056842134763, 24.097548251590872]]]),
    Gabon_1 = /* color: #ff9999 */ee.Geometry.Polygon(
        [[[10.25804476318126, -0.565524761935958],
          [10.32945589599376, -0.5710176558152015],
          [10.34044222411876, -0.518834959194786],
          [10.47502474365001, -0.4584123545923344],
          [10.48601107177501, -0.34855181427954035],
          [10.55192904052501, -0.3018606731528416],
          [10.62608675536876, -0.25791588606141247],
          [10.64805941161876, -0.2139709472467875],
          [10.70573763427501, -0.20298469186576007],
          [10.77714876708751, -0.2249571947607893],
          [10.80461458740001, -0.167279312427572],
          [10.85405306396251, -0.13706701699180493],
          [10.88975863036876, -0.14530673806192956],
          [10.96940950927501, -0.12333414232631836],
          [11.09575228271251, -0.1398135910052283],
          [11.13969759521251, -0.09861495060351845],
          [11.23033480224376, -0.10960126057548468],
          [11.32646517333751, -0.1398135910052283],
          [11.40336947021251, -0.12882729308694094],
          [11.44731478271251, -0.1398135910052283],
          [11.49949984130626, -0.11509441407556989],
          [11.54069857177501, -0.10685468344449431],
          [11.57640413818126, -0.13706701699180493],
          [11.61210970458751, -0.12882729308694094],
          [11.63408236083751, -0.08488205808713056],
          [11.67253450927501, -0.08762863700575806],
          [11.72197298583751, -0.13157386802633828],
          [11.80437044677501, -0.12882729308694094],
          [11.87303499755626, -0.09586837252820868],
          [11.92522005615001, -0.13706701699180493],
          [12.00487093505626, -0.13706701699180493],
          [12.05156282958751, -0.15903959974986248],
          [12.14494661865001, -0.15903959974986248],
          [12.18339876708751, -0.12058756651773901],
          [12.10374788818126, -0.08762863700575806],
          [12.05430941161876, -0.08762863700575806],
          [11.95817904052501, -0.06290942024629326],
          [11.85930208740001, -0.024457283706178785],
          [11.82908968505626, -0.04917651669237557],
          [11.74394564208751, -0.07114916069439257],
          [11.66704134521251, -0.029950447147405714],
          [11.56816439208751, -0.03269702876793985],
          [11.43907503661876, -0.0684025807001015],
          [11.38414339599376, -0.08213547897344603],
          [11.30723909911876, -0.07114916069439257],
          [11.25230745849376, -0.054669678497143506],
          [11.16716341552501, -0.03269702876793985],
          [11.10673861083751, -0.04093677315347681],
          [11.07927279052501, -0.07664232018615937],
          [10.92546419677501, -0.06565600054864014],
          [10.87877230224376, -0.07664232018615937],
          [10.82109407958751, -0.07664232018615937],
          [10.76066927490001, -0.10685468344449431],
          [10.73869661865001, -0.14805331109257427],
          [10.62059359130626, -0.15079988378300144],
          [10.56840853271251, -0.2194640720124059],
          [10.51347689208751, -0.26340899327534345],
          [10.43931917724376, -0.29087449201774124],
          [10.42558626708751, -0.3540448750880081],
          [10.41734652099376, -0.4089752958602145],
          [10.35417513427501, -0.44193337111856534],
          [10.29649691161876, -0.4721448119108808],
          [10.26353792724376, -0.5215814280199634]]]),
    Gabon_2 = /* color: #0b4a8b */ee.Geometry.Polygon(
        [[[9.143579266292932, -1.0385446274481154],
          [9.140832684261682, -1.066005815548317],
          [9.186151287777307, -1.0673788685769638],
          [9.210870526058557, -1.0790497944889104],
          [9.236963055355432, -1.0831689341449566],
          [9.266488812191369, -1.090720675623698],
          [9.308374188167932, -1.085915024139724],
          [9.343393109066369, -1.0714980239814502],
          [9.366739056331994, -1.0392311600848094],
          [9.396951458675744, -1.0179485794470298],
          [9.439523480160119, -1.011083200748223],
          [9.486902020199182, -1.0152024297160132],
          [9.511621258480432, -1.0131428158867717],
          [9.523980877621057, -0.9973523998941441],
          [9.537027142269494, -0.9863677179278563],
          [9.554879925472619, -0.9829349973585416],
          [9.586465618831994, -0.9726368145284197],
          [9.633844158871057, -0.9499807021558812],
          [9.661309979183557, -0.9389958667067746],
          [9.691522381527307, -0.9259513298107607],
          [9.700620434505822, -0.9181417485237324],
          [9.70268037102926, -0.9158246167218249],
          [9.703452847225549, -0.9132500240740717],
          [9.710233471615197, -0.9034665552381559],
          [9.712808392269494, -0.8991755518066474],
          [9.720704815609338, -0.8899927875479479],
          [9.727227947933557, -0.8828696929727449],
          [9.738922896041231, -0.8784949704340084],
          [9.751282515181856, -0.8712860331219584],
          [9.765358748092012, -0.8692263342085027],
          [9.792824568404512, -0.8702561838058238],
          [9.806557478560762, -0.8620173791821881],
          [9.819260420455294, -0.8517188483559885],
          [9.817200483931856, -0.8366142867921365],
          [9.800034346236544, -0.8386740031800303],
          [9.786988081588106, -0.8475994283015291],
          [9.771881880416231, -0.8489725688076047],
          [9.745789351119356, -0.8482859986154809],
          [9.733773054732637, -0.8482859986154809],
          [9.712830366744356, -0.8633905145285772],
          [9.698067488326387, -0.8774651230954281],
          [9.693947615279512, -0.8901665536871955],
          [9.674378218306856, -0.9087036980240011],
          [9.651718916549044, -0.9038977807703972],
          [9.639359297408419, -0.9097335366047713],
          [9.614983381881075, -0.9275840250149935],
          [9.596787275924044, -0.9368525124389863],
          [9.5614250322717, -0.9498970087035795],
          [9.532585920943575, -0.9629414557274741],
          [9.520912947310762, -0.9746127607731669],
          [9.4955070635217, -0.9811349430666331],
          [9.488297285689669, -0.990403285485652],
          [9.47544473361836, -0.9929941494015395],
          [9.454845368383985, -0.9806363634044895],
          [9.414333283423048, -0.9847556305011635],
          [9.39030069064961, -0.9847556305011635],
          [9.366954743383985, -0.9888748925072707],
          [9.358714997290235, -1.0005461070271384],
          [9.336055695532423, -1.0177095822264874],
          [9.325756012915235, -1.0362460328093324],
          [9.306529938696485, -1.0513497272463737],
          [9.286617218969923, -1.052722786769675],
          [9.265331208227735, -1.0513497272463737],
          [9.246791779516798, -1.0520362570835562],
          [9.22550576877461, -1.060274603318781],
          [9.212459504126173, -1.0534093163046412],
          [9.20902627658711, -1.041738293719595],
          [9.193233429907423, -1.0362460328093324],
          [9.165767609594923, -1.0348729660918454]]]),
    Gabon_3 = /* color: #99ff99 */ee.Geometry.Polygon(
        [[[9.712848229978135, -0.9004082273499467],
          [9.704265161130479, -0.9131095784621844],
          [9.697055383298448, -0.9385121454351113],
          [9.706325097653917, -0.9546461127553237],
          [9.706325097653917, -0.9683770891916694],
          [9.711818261716417, -0.980391647973524],
          [9.727267785642198, -0.9814214652990798],
          [9.741000695798448, -0.970093457351501],
          [9.764003320310167, -0.970093457351501],
          [9.779452844235948, -0.9841676432828237],
          [9.783572717282823, -1.0112860284589384],
          [9.797305627439073, -1.024673502542262],
          [9.824771447751573, -1.0267331089922223],
          [9.851207299802354, -1.0057937153842076],
          [9.857387109372667, -0.9628847052475521],
          [9.847087426755479, -0.9343928226522299],
          [9.815501733396104, -0.90384102933767],
          [9.788035913083604, -0.8983485446049554],
          [9.766063256833604, -0.9062439887991959],
          [9.748897119138292, -0.9079603874388046],
          [9.73619417724376, -0.8976619834318286]]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
/***
 * 
 * Demo areas
 * 
 * Test sites (for round-robin,min area 500 000km2)
 *    Reservoirs and Lakes
 *    Rivers (sections)
 *    Wetlands
 * 
 * Technical doc:
 * The Proofs of Concept shall aim at verifying the robustness and scalability of the proposed solutions.
 * It shall cover a wide geographical area in each of the 5 pilot countries, which shall be large enough to 
 * include a number of imagery tiles. For the PoC, the Contractor shall process the full time series of 
 * radar and optical satellite data for two consecutive years, complemented with the surface water level 
 * observations to derive information on the changes in surface volume.  The Proofs of Concept shall 
 * collectively cover a geographical area of at least 500,000 km2.
 * 
 * Gena email:
 * •	How much dynamics is present: user JRC to quantify this based on manually drawn polygon geometry (per site), surface water dynamics intra-annual (seasonality) and inter-annual (long-term changes, meandering rivers, constructions, etc.)
 * •	The complexity of water detection: hill-shadows, cloud frequency/types/shadows, clearance of water (algae/aquaculture/color/waves), snow/ice, wetlands (mix of soil/vegetation)
 * •	The presence of ground truth data: high-frequency water level measurements, high-resolution DEM and/or cross-sections
 * •	Gena creates EE repository to draw sites (make it an app 🙂)
 * 
 * Update (04-09-2019):
 * •	Added sites described in document on SharePoint
 * •	Added sites in Colombia, Mexico and Gabon (first guess)
 * •	Added Sentinel-3 A/B tracks for better identification of good sites (not used for current sites yet)
 * •	Added global HydroWeb locations (http://hydroweb.theia-land.fr)
 * 
 * Update (05-09-2019):
 * •	Checked if chosen locations have S3 track and/or HydroWeb location
 * •	Removed not-relevant location in Mexico (no S3 track, no HydroWeb)
 * •	Added new locations in Mexico, Colombia and Gabon (with S3 track / HydroWeb location)
 * •	Added other satellite tracks that we intend to use (Jason 2/3, SARAL/AltiKa)
 * 
 * Update (09-09-2019):
 * •	Small fixes
 * •	Checked locations against satellite tracks other than previously checked Sentinel-3
 * •	Added large-scale test sites/basin and calculation of area
 *
 * Update (10-09-2019):
 * •	Removed horizontal lines from Sentinel-3 tracks (as done previously for other tracks)
 * •	Added quick estimation of open water area (based on JRC) for each test site
 * •	Added export of test sites
 * 
 * To-Do:
 * •	Add locations from DAHITI (https://dahiti.dgfi.tum.de/en)
 * •	Add any in situ / ground observation points that we already know
*/

var do_export = false;

// ----------------------------------------------------------------------------------------- //
// Test sites
// ----------------------------------------------------------------------------------------- //

// large-scale test sites
var large_scale_test_sites = ee.List(['Rio Magdalena', 'Zambezi', 'Usumacinta', 'Ogooue', 'Ebro']);

// countries
countries = countries.filter(ee.Filter.inList('country_co', ['SP', 'MX', 'CO', 'GB', 'ZA']));

// assign properties to manually drawn test sites
Colombia_1 = ee.Feature(Colombia_1, {
  'name': 'Cienaga Grande de Santa Marta',
  'river': 'Rio Magdalena',
  'country': 'Colombia',
  'types': ['lake'],
  'classification': 'seasonally flooding lake system',
  'challenges': ['extent'],
  'id': 1
});
Colombia_2 = ee.Feature(Colombia_2, {
  'name': 'Cienaga Grande',
  'river': 'Rio Magdalena',
  'country': 'Colombia',
  'types': ['river','wetland','lake'],
  'classification': 'large area of rivers, lakes and wetlands',
  'challenges': ['extent'],
  'id': 2
});
Colombia_3 = ee.Feature(Colombia_3, {
  'name': 'Meta River',
  'river': 'Meta',
  'country': 'Colombia',
  'types': ['river'],
  'classification': 'river with inter- and intra-annual variability',
  'challenges': ['extent','level'],
  'id': 3
});
Spain_1 = ee.Feature(Spain_1, {
  'name': 'Ebro Reservoir',
  'river': 'Ebro',
  'country': 'Spain',
  'types': ['reservoir'],
  'classification': 'highly variable reservoir for irrigation',
  'challenges': ['extent','level','volume'],
  'id': 1
});
Spain_2 = ee.Feature(Spain_2, {
  'name': 'Sotonera Reservoir',
  'river': 'Ebro',
  'country': 'Spain',
  'types': ['reservoir'],
  'classification': 'highly variable reservoir for irrigation',
  'challenges': ['extent','level','volume'],
  'id': 2
});
Zambia_1 = ee.Feature(Zambia_1, {
  'name': 'Barotse Floodplain',
  'river': 'Zambezi',
  'country': 'Zambia',
  'types': ['river', 'floodplain'],
  'classification': 'seasonally inundated floodplain grasslands',
  'challenges': ['extent','level'],
  'id': 1
});
Zambia_2 = ee.Feature(Zambia_2, {
  'name': 'Lake Bangweulu',
  'river': 'Congo',
  'country': 'Zambia',
  'types': ['lake','wetland'],
  'classification': 'seasonally changing shallow lake and inundated grasslands',
  'challenges': ['extent','level','volume'],
  'id': 2
});
Zambia_3 = ee.Feature(Zambia_3, {
  'name': 'Lake Kariba',
  'river': 'Zambezi',
  'country': 'Zambia',
  'types': ['reservoir'],
  'classification': 'largest reservoir by volume, used for hydropower, fisheries and tourism, two countries',
  'challenges': ['extent','level','volume'],
  'id': 3
});
Mexico_1 = ee.Feature(Mexico_1, {
  'name': 'Pantanos de Centla',
  'river': 'Usumacinta',
  'country': 'Mexico',
  'types': ['wetland'],
  'classification': 'seasonally flooded forests and wetlands',
  'challenges': ['extent'],
  'id': 1
});
Mexico_2 = ee.Feature(Mexico_2, {
  'name': 'Falcon International Reservoir',
  'river': 'Rio Grande',
  'country': 'Mexico',
  'types': ['reservoir'],
  'classification': 'reservoir, used for hydropower, irrigation, flood control, two countries',
  'challenges': ['extent','level','volume'],
  'id': 2
});
Mexico_3 = ee.Feature(Mexico_3, {
  'name': 'Malpaso Reservoir',
  'river': 'Grijalva',
  'country': 'Mexico',
  'types': ['reservoir'],
  'classification': 'hydropower and flood control reservoir with variable water levels and flooding problems',
  'challenges': ['extent','level','volume'],
  'id': 3
});
Mexico_4 = ee.Feature(Mexico_4, {
  'name': 'Las Adjuntas Lake',
  'river': 'Rio Soto la Marina',
  'country': 'Mexico',
  'types': ['reservoir'],
  'classification': 'highly variable reservoir used mainly for irrigation',
  'challenges': ['extent','level','volume'],
  'id': 4
});
Gabon_1 = ee.Feature(Gabon_1, {
  'name': 'Middle Ogooue River',
  'river': 'Ogooue',
  'country': 'Gabon',
  'types': ['river'],
  'classification': 'river',
  'challenges': ['extent','level'],
  'id': 1
});
Gabon_2 = ee.Feature(Gabon_2, {
  'name': 'Lower Ogooue River',
  'river': 'Ogooue',
  'country': 'Gabon',
  'types': ['river'],
  'classification': 'river',
  'challenges': ['extent','level'],
  'id': 2
});
Gabon_3 = ee.Feature(Gabon_3, {
  'name': 'Lake Avanga',
  'river': 'Ogooue',
  'country': 'Gabon',
  'types': ['reservoir'],
  'classification': 'reservoir',
  'challenges': ['extent','level','volume'],
  'id': 3
});

// merge individual sites into single FeatureCollection
var test_sites = ee.FeatureCollection([
  Colombia_1, Colombia_2, Colombia_3, Spain_1, Spain_2, Zambia_1, Zambia_2, Zambia_3, Mexico_1, Mexico_2, Mexico_3, Gabon_1, Gabon_2, Gabon_3
]);
// print('Test sites:', test_sites);

// discarded sites due to absense of altimetry satellite tracks and/or other data
var discard_sites = ee.FeatureCollection([
  Mexico_4
]);
// print('Discarded sites:', discard_sites);

// ----------------------------------------------------------------------------------------- //
// Processing
// ----------------------------------------------------------------------------------------- //

// centroids for easy visualization on map
var test_sites_points    = test_sites.map(function(f) {return f.geometry().centroid()});
var discard_sites_points = discard_sites.map(function(f) {return f.geometry().centroid()});

// types
var types_test_sites = ee.List(test_sites.aggregate_array('types')).flatten().reduce(ee.Reducer.frequencyHistogram());
print('Test site types:', types_test_sites);

// challenges
var challenges_test_sites = ee.List(test_sites.aggregate_array('challenges')).flatten().reduce(ee.Reducer.frequencyHistogram());
print('Test site challenges:', challenges_test_sites);

// rivers/catchments
var rivers_test_sites     = ee.Dictionary(test_sites.aggregate_histogram('river')).keys();
print('Test site rivers/basins:', rivers_test_sites);
var catchments_test_sites = catchments.filter(ee.Filter.inList('NAME', rivers_test_sites));
var catchments_other      = catchments.filter(ee.Filter.inList('NAME', rivers_test_sites).not());
var catchments_chosen     = catchments.filter(ee.Filter.inList('NAME', large_scale_test_sites));

var catchments_test_sites_in_countries = catchments_test_sites.map(function(f) {
  return f.intersection(countries.geometry());
}, true);
var catchments_chosen_in_countries = catchments_chosen.map(function(f) {
  var new_area = f.intersection(countries.geometry());
  return new_area.set('area', new_area.area().divide(1e6).round());
}, true);
// print(catchments_chosen_in_countries);

// filter global datasets
hydroweb_locs = hydroweb_locs.filter(ee.Filter.or(
  ee.Filter.bounds(countries),
  ee.Filter.bounds(catchments_other)
));

// calculate area of open water per test site
test_sites = test_sites.map(function(f) {
  var centroid   = f.geometry().centroid();
  var area_water = JRC_water.select('occurrence').gte(30);
  var area_pixel = ee.Image.pixelArea();
  var area_val   = area_pixel.multiply(area_water).reduceRegion({
    reducer: ee.Reducer.sum(),
    geometry: f.geometry(),
    scale: 30,
    // crs: ,
    // crsTransform: ,
    // bestEffort: ,
    maxPixels: 1e12,
    // tileScale:
  }).values().get(0);
  return f.set({'centroid':centroid, 'area_water':ee.Number(area_val).divide(1e6).round()});
});
print('All test sites:', test_sites);

// total areas
// print('Total area test sites (km2):', test_sites.geometry().area().divide(1e6).round());
// print('Area test sites basins:', catchments_test_sites.geometry().area().divide(1e6).round());
// print('Area test sites basins within countries:', catchments_test_sites_in_countries.geometry().area().divide(1e6).round());
print('Total area large-scale test sites:', catchments_chosen_in_countries.geometry().area().divide(1e6).round());

// ----------------------------------------------------------------------------------------- //
// Export
// ----------------------------------------------------------------------------------------- //

if (do_export) {
  Export.table.toDrive({
    collection: test_sites,
    description: 'WWSWD_test_sites',
    folder: 'EarthEngine',
    // fileNamePrefix: ,
    fileFormat: 'SHP',
    selectors: ['area_water', 'classification', 'country', 'name', 'river', 'id']
  });
}

// ----------------------------------------------------------------------------------------- //
// Map
// ----------------------------------------------------------------------------------------- //

// Map.centerObject(test_sites);
Map.centerObject(countries);

// background
Map.addLayer(ee.Image(1), { palette: ['ffffff'] }, 'white background', true, 0.5);
Map.addLayer(ee.Image(1), { palette: ['000000'] }, 'black background', false, 0.5);

// JRC water
Map.addLayer(JRC_water.select('occurrence'), {min:0, max:100, palette:['white','blue']}, 'JRC occurrence', true);
Map.addLayer(JRC_water.select('recurrence'), {min:0, max:100, palette:['white','blue']}, 'JRC recurrence', false);
Map.addLayer(JRC_water.select('seasonality'), {min:0, max:12, palette:['white','blue']}, 'JRC seasonality', false);

// satellite (altimetry) tracks
Map.addLayer(SARAL_AltiKa_tracks, {color:'grey'}, 'SARAL/AltiKa tracks', false);
Map.addLayer(Jason2_tracks_before_Oct2016, {color:'grey'}, 'Jason-2 tracks (before Oct 2016)', false);
Map.addLayer(Jason2_tracks_after_Oct2016, {color:'grey'}, 'Jason-2 tracks (after Oct 2016)', false);
Map.addLayer(Jason3_tracks, {color:'grey'}, 'Jason-3 tracks', false);
Map.addLayer(S3A_tracks, {color:'grey'}, 'Sentinel-3A tracks', false);
Map.addLayer(S3B_tracks, {color:'grey'}, 'Sentinel-3B tracks', false);

// HydroWeb
Map.addLayer(hydroweb_locs, {color:'green'}, 'HydroWeb locations', false);

// countries
Map.addLayer(ee.Image().byte().paint(countries,0,2), {palette:'grey'}, 'countries', false);

// catchments
Map.addLayer(ee.Image().byte().paint(catchments,0,2), {}, 'catchments (all)', false);
Map.addLayer(ee.Image().byte().paint(catchments_test_sites,0,2), {}, 'catchments (test sites)', false);
Map.addLayer(ee.Image().byte().paint(catchments_test_sites_in_countries,0,2), {}, 'catchments (test sites/countries)', false);
Map.addLayer(ee.Image().byte().paint(catchments_chosen,0,2), {}, 'catchments (large-scale sites)', false);
Map.addLayer(ee.Image().byte().paint(catchments_chosen_in_countries,0,2), {}, 'catchments (large-scale sites/countries)', false);
Map.addLayer(ee.Image().byte().paint(catchments_other,0,2), {}, 'catchments (other)', false);

// test sites
// Map.addLayer(ee.Image().byte().paint(discard_sites,0,2), {palette:'orange'}, 'discarded sites', false);
Map.addLayer(ee.Image().byte().paint(test_sites,0,2), {palette:'orange'}, 'test sites', true);

// Map.addLayer(discard_sites_points, {color:'red'}, 'discarded sites (points)', false);
Map.addLayer(test_sites_points, {color:'red'}, 'test sites (points)', true);
